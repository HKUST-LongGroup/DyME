compute_environment: LOCAL_MACHINE
distributed_type: MULTI_GPU  # 核心修改：改为 MULTI_GPU 或 DDP
downcast_bf16: 'no'
gpu_ids: all
machine_rank: 0
main_process_ip: 'XX.XX.XX.XX' # 您的主节点IP,需要替换
main_process_port: XX          # 您提供的端口,需要替换
main_training_function: main
mixed_precision: 'bf16'
num_machines: 8                   # 您的机器总数
# 假设每台机器有8个GPU (8台 * 8个GPU = 64个进程)
num_processes: 64
rdzv_backend: static
same_network: true
tpu_use_cluster: false
tpu_use_sudo: false
use_cpu: false

# 新增: 添加deepspeed_config部分来配置ZeRO-2
deepspeed_config:
  zero_stage: 2
  gradient_accumulation_steps: 16
  gradient_clipping: "auto"
  offload_optimizer_device: "cpu" # 推荐：将优化器状态卸载到CPU以节省GPU内存
  offload_param_device: "cpu"
  zero3_init_flag: false
  zero3_save_16bit_model: "auto"